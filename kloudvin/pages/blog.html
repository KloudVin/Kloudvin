<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog — KloudVin</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&family=Sora:wght@300;400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/category-modal.css">
</head>
<body>
<div class="content">
  <section class="section" style="padding-top:8rem">
    <div class="section-head"><span class="section-tag">// all articles</span><h2 class="section-title">Blog</h2><p class="section-sub">Every article — from cloud architecture to shell scripting</p></div>
    <div style="display:flex;justify-content:center;flex-wrap:wrap;gap:.5rem;margin-bottom:3rem" id="filterBtns"></div>
    <div class="posts-wrap" id="postsGrid"></div>
  </section>
</div>

<!-- EmailJS Library -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script src="../js/db.js?v=3"></script>
<script src="../js/app.js?v=3"></script>
<script src="../js/components.js?v=3"></script>
<script>
loadComponents(true);

// Get category from URL parameter
var urlParams = new URLSearchParams(window.location.search);
var selectedCategory = urlParams.get('category') || 'all';

// Render filter buttons dynamically
renderBlogFilters();

// Filter posts function
function filterPosts(category) {
  var grid = document.getElementById('postsGrid');
  grid.innerHTML = '';
  
  var list = category === 'all' ? articles : articles.filter(function(a) { return a.category === category; });
  
  if (!list.length) {
    grid.innerHTML = '<div style="text-align:center;color:#475569;padding:3rem;grid-column:1/-1"><i class="fas fa-folder-open" style="font-size:2rem;margin-bottom:1rem;display:block;color:#00f0ff"></i>No articles in ' + category + ' category yet.</div>';
    return;
  }
  
  list.forEach(function(a) {
    var cc = categoryColors[a.category] || categoryColors.Cloud;
    var icon = categoryIcons[a.category] || 'fa-file-alt';
    var card = document.createElement('div');
    card.className = 'pcard';
    card.onclick = function() { window.location.href = 'article.html?id=' + a.id; };
    card.innerHTML = '<div class="pcard-thumb" style="background:' + cc.thumb + ';color:' + cc.color + '"><i class="fas ' + icon + '"></i></div><div class="pcard-body"><div class="pcard-meta"><span class="pcard-cat" style="background:' + cc.bg + ';color:' + cc.color + '">' + a.category + '</span><span class="pcard-date">' + (a.date_published || a.date) + '</span></div><h3>' + a.title + '</h3><p>' + (a.description || a.desc) + '</p><div class="pcard-foot"><span class="pcard-read">Read <i class="fas fa-arrow-right"></i></span></div></div>';
    grid.appendChild(card);
  });
}

// Load articles first, then filter
renderPostsSub('postsGrid').then(function() {
  // After articles are loaded, apply filter if category is selected
  if (selectedCategory && selectedCategory !== 'all') {
    // Filter posts directly instead of clicking button
    filterPosts(selectedCategory);
    // Update active button
    var buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(function(b) { b.classList.remove('active'); });
    var btn = document.querySelector('.filter-btn[data-cat="' + selectedCategory + '"]');
    if (btn) {
      btn.classList.add('active');
    }
  }
});

var el = document.getElementById('nav-blog');
if (el) el.classList.add('active');
</script>
</body></html>
